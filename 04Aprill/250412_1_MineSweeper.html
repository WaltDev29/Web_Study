<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <header>
        <h1>Mine Sweeper</h1>
    </header>
    <main>
        <label>í•„ë“œ í¬ê¸° : 
            <input type="text" id="fieldSizeInput" placeholder="ex) 10">
        </label><br>
        <label>ì§€ë¢° ê°œìˆ˜ : 
            <input type="text" id="mineCountInput" placeholder="ex) 40">
        </label><br>
        <button id="makeBtn">ì‹œì‘</button>
        <div id="fieldContainer"></div>
    </main>
    
        <script>
            // ê°ì²´ ì„ ì–¸
            class Tile {
                constructor(mine, near, check) {
                    // ê¸°ë³¸ ì†ì„±
                    this.mine = mine;
                    this.near = near;
                    this.check = check;

                    // ìš”ì†Œ ìƒì„±
                    this.div = document.createElement("span");
                    this.div.style.display = "flex";
                    this.div.style.alignItems = "center";
                    this.div.style.justifyContent = "center";
                    this.div.style.width = "40px";
                    this.div.style.height = "40px";
                    this.div.style.border = "1px solid black";
                    this.div.addEventListener("click", () => {
                        tileClicked(this);
                    });
                }
            }

            // HTML ìš”ì†Œ ë³€ìˆ˜ ì„ ì–¸
            var fieldSizeInput = document.querySelector("#fieldSizeInput");
            var mineCountInput = document.querySelector("#mineCountInput");
            var fieldContainer = document.querySelector("#fieldContainer");
            var makeBtn = document.querySelector("#makeBtn");

            // í•„ë“œ ê´€ë ¨ ë³€ìˆ˜ ì„ ì–¸
            var fieldSize;  // í•„ë“œ í¬ê¸°
            var mineCount;  // ì§€ë¢° ê°œìˆ˜
            var flag;   // í´ë¦¬ì–´ ì—¬ë¶€ íŒë‹¨     -1 : dead   1 : clear
            
            // ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            makeBtn.addEventListener("click", function() {
                fieldSize = parseInt(fieldSizeInput.value);
                mineCount = parseInt(mineCountInput.value);
                fieldContainer.textContent = "";    // í•„ë“œ ì´ˆê¸°í™”
                flag = 0;
                makeField();
            });

            // íƒ€ì¼ í´ë¦­ ì´ë²¤íŠ¸
            function tileClicked(self) {
                if (flag == -1 || flag == 1) return;
                self.check = 1;
                if (self.mine == 1) {
                    flag = -1;
                    alert("í‘! ì§€ë¢°ë¥¼ ë°Ÿì•˜ìŠµë‹ˆë‹¤!");
                    showTiles(flag);
                    return;
                }
                self.div.textContent = self.near;
                if (self.near == 0) {
                    checkTiles();
                }
                flag = checkClear();
                if (flag == 1) {
                    alert("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ì§€ë¢°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!");
                    showTiles(flag);
                }
            }

            // ì£¼ë³€ íƒ€ì¼ ì²´í¬
            function checkTiles() {
                let checked = 0;
                while (checked == 0) {
                    checked = 1;
                    for (let i=0; i<fieldSize; i++) {
                        for (let j=0; j<fieldSize; j++) {
                            if (field[i][j].check == 1 && field[i][j].near == 0) {
                                for (let k=-1; k<=1; k++) {
                                    for (let l=-1; l<=1; l++) {
                                        if ((i+k < 0 || i+k >= fieldSize) || (j+l < 0 || j+l >= fieldSize)) continue;
                                        else if (k != 0 && l != 0) {
                                            if (field[i+k][j+l].near == 0) continue;
                                        }
                                        if (field[i+k][j+l].check == 1) continue;
                                            field[i+k][j+l].div.textContent = field[i+k][j+l].near;
                                            field[i+k][j+l].check = 1;
                                            checked = 0;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // í´ë¦¬ì–´ ì¡°ê±´ ì²´í¬
            function checkClear() {
                let checkedTiles = 0;
                for (let i=0; i<fieldSize; i++) {
                    for (let j=0; j<fieldSize; j++) {
                        if (field[i][j].check == 1) checkedTiles++;
                    }
                }
                if (checkedTiles >= (fieldSize * fieldSize) - mineCount) return 1;  // clear
                else return 0;  // yet
            }

            // ìµœì¢… íƒ€ì¼ ë³´ì—¬ì£¼ê¸°
            function showTiles(flag) {
                for (let i=0; i<fieldSize; i++) {
                    for (let j=0; j<fieldSize; j++) {
                        if (flag == -1) {
                            if (field[i][j].mine == 1) field[i][j].div.textContent = 'ğŸ’£';
                        }
                        if (flag == 1) {
                            if (field[i][j].mine == 1) field[i][j].div.textContent = 'ğŸ’£';    
                            else field[i][j].div.textContent = field[i][j].near;
                        }
                    }
                }
            }
            
            // í•„ë“œ ìƒì„±
            function makeField() {
                // ë°°ì—´ ìƒì„±
                field = new Array(fieldSize);
                for (let i=0; i<fieldSize; i++) {
                    field[i] = new Array(fieldSize);
                }
                setTiles();
                setMine();
                setNear();
            }
            
            // íƒ€ì¼ ìƒì„±
            function setTiles() {
                for (let i=0; i<fieldSize; i++) {
                    let row = document.createElement("div");
                    row.style.display = "flex";
                    fieldContainer.appendChild(row);
                    for (let j=0; j<fieldSize; j++) {
                        let tile = new Tile(0, 0, 0);
                        field[i][j] =  tile ;
                        row.appendChild(field[i][j].div);
                    }
                }
            }

            // ì§€ë¢° ì„¤ì¹˜
            function setMine() {
                for (var i=0; i<mineCount; i++) {
                    var x = Math.floor(Math.random() * fieldSize);
                    var y = Math.floor(Math.random() * fieldSize);
                    if (field[x][y].mine == 1) {
                        i--;
                        continue;
                    }
                    field[x][y].mine = 1;
                }
            }

            // nearê°’ ì„¤ì •
            function setNear() {
                for (var i=0; i<fieldSize; i++) {
                    for (var j=0; j<fieldSize; j++) {
                        for (var k=-1; k<=1; k++) {
                            for (var l=-1; l<=1; l++) {
                                if ((i+k < 0 || i+k >= fieldSize) || (j+l < 0 || j+l >= fieldSize)) continue;
                                else if (field[i+k][j+l].mine == 1) field[i][j].near++;
                            }
                        }
                    }
                }
            }
        </script>
</body>
</html>